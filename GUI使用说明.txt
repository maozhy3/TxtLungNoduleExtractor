========================================
医疗影像报告预测工具 - GUI使用说明
========================================

【界面布局】

┌─────────────────────────────────────┐
│  医疗影像报告批量预测工具            │
├─────────────────────────────────────┤
│  输入文件: [____________] [浏览...]  │
│  输出文件: [____________] [浏览...]  │
│                                      │
│  模型列表:                           │
│  ┌──────────────────────────────┐  │
│  │ model1.gguf                  │  │
│  │ model2.gguf                  │  │
│  └──────────────────────────────┘  │
│  [添加模型] [删除选中]              │
│                                      │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                      │
│  运行参数配置:                       │
│  ┌─ 性能参数 ──────────────────┐  │
│  │ CPU线程数: [8]  GPU层数: [0] │  │
│  │ 并行进程数:[1]  检查点间隔:[5000]│
│  └──────────────────────────────┘  │
│                                      │
│  [开始预测] [停止]                  │
│                                      │
│  运行日志:                           │
│  ┌──────────────────────────────┐  │
│  │ 正在加载模型...              │  │
│  │ ✓ 模型加载成功               │  │
│  │ 预测进度: 50/100             │  │
│  └──────────────────────────────┘  │
│                                      │
│  状态: 就绪                         │
└─────────────────────────────────────┘

========================================
【功能说明】
========================================

1. 文件选择
   - 输入文件：选择包含 yxbx 列的 Excel 文件
   - 输出文件：指定结果保存路径

2. 模型管理
   - 添加模型：选择 .gguf 格式的模型文件
   - 删除选中：删除列表中选中的模型
   - 支持多个模型同时预测

3. 运行参数配置
   
   【CPU线程数】
   - 每个进程使用的CPU线程数
   - 建议值：4-8
   - 说明：线程数越多，单个进程速度越快
   
   【GPU层数】
   - 使用GPU加速的层数
   - 0 = 纯CPU模式
   - >0 = 使用GPU（需要NVIDIA显卡和CUDA）
   - 建议值：0（CPU）或 35（GPU）
   
   【并行进程数】
   - 同时运行的进程数量
   - 1 = 单进程模式（节省内存）
   - 2-4 = 多进程模式（加快速度）
   - 注意：内存占用 = 模型大小 × 进程数
   
   【检查点间隔】
   - 每处理多少条数据保存一次检查点
   - 建议值：5000-10000
   - 说明：间隔越小，断点续传越精确，但保存频率越高

4. 控制按钮
   - 开始预测：启动预测任务
   - 停止：中断当前任务（会保存检查点）

5. 运行日志
   - 实时显示运行状态和进度
   - 显示错误信息和警告
   - 可以滚动查看历史日志

========================================
【参数配置建议】
========================================

【低配机器】（4核CPU，8GB内存）
CPU线程数: 4
GPU层数: 0
并行进程数: 1
检查点间隔: 5000

适用场景：内存有限，追求稳定

【中配机器】（8核CPU，16GB内存）
CPU线程数: 4
GPU层数: 0
并行进程数: 2
检查点间隔: 5000

适用场景：平衡速度和内存占用

【高配机器】（16核CPU，32GB内存）
CPU线程数: 4
GPU层数: 0
并行进程数: 4
检查点间隔: 10000

适用场景：追求最快速度

【GPU加速】（有NVIDIA显卡）
CPU线程数: 4
GPU层数: 35
并行进程数: 1
检查点间隔: 5000

适用场景：有独立显卡，追求速度

========================================
【使用流程】
========================================

1. 准备数据
   - Excel文件必须包含 yxbx 列
   - 确保数据格式正确

2. 配置参数
   - 选择输入/输出文件
   - 添加模型文件
   - 根据机器配置调整运行参数

3. 开始预测
   - 点击"开始预测"按钮
   - 观察日志输出
   - 等待完成

4. 查看结果
   - 结果保存在指定的输出文件
   - 每个模型会新增一列 pred_模型名

========================================
【断点续传】
========================================

如果预测过程中断（停电、手动停止等）：

1. 检查点会自动保存在 checkpoints/ 目录
2. 再次运行程序，选择相同的输入文件和模型
3. 程序会自动检测并从上次中断处继续
4. 日志会显示：已完成 X/Y 条，继续处理剩余 Z 条

注意：
- 必须使用相同的输入文件和模型
- 修改配置参数不影响断点续传
- 任务完成后检查点会自动清除

========================================
【常见问题】
========================================

Q1: 点击"开始预测"没反应？
A: 检查：
   - 输入文件是否存在
   - 是否添加了模型
   - 查看日志是否有错误信息

Q2: 预测速度很慢？
A: 尝试：
   - 增加CPU线程数
   - 增加并行进程数（如果内存充足）
   - 使用GPU加速（如果有显卡）

Q3: 提示内存不足？
A: 调整：
   - 并行进程数改为 1
   - 减少CPU线程数
   - 关闭其他程序

Q4: GPU加速不生效？
A: 确认：
   - 有NVIDIA显卡
   - 已安装CUDA驱动
   - GPU层数设置 > 0
   - 查看日志是否有GPU相关错误

Q5: 如何知道最佳配置？
A: 建议：
   - 先用默认配置测试
   - 观察CPU和内存使用率
   - 逐步调整参数
   - 记录不同配置的速度

========================================
【性能监控】
========================================

运行时可以打开任务管理器观察：

- CPU使用率：应该接近 100%（充分利用）
- 内存使用：不应超过可用内存的 80%
- GPU使用率：如果启用GPU，应该有明显占用

如果CPU使用率低：
- 增加线程数或进程数

如果内存占用过高：
- 减少进程数
- 使用单进程模式

========================================
【技巧和建议】
========================================

1. 首次使用建议用小数据集测试
2. 大批量数据建议在夜间运行
3. 定期保存配置参数（可创建config.py）
4. 重要数据建议先备份
5. 长时间运行建议关闭屏幕保护和休眠

========================================
